## PR #14 리뷰/판단 메모 (merge decision)

대상: PR #14 `2026 01 16 rawe` (`2026-01-16-rawe` → `main`)

---

### 1) 변경 요약(무슨 PR인가)

- **런타임 에러 해결(의존성 누락)**: `fuse.js`, `react-tweet-embed`, `@upstash/redis`, `dotenv` 추가
- **pnpm 설치 안정화**: `.npmrc`에 `store-dir=.pnpm-store/v10` 고정 → `ERR_PNPM_UNEXPECTED_STORE` 재발 방지
- **React 19 호환**: `react-body-classname` 제거(피어 충돌) + `NotionPage`에서 내부 body class 토글로 대체
- **TS/타입 안정화**: `JSX` 네임스페이스/`ref` 타입 등 컴파일 에러 정리
- **레포 운영/문서/템플릿/CI 추가**: `.github/workflows/ci.yml`, 이슈/PR 템플릿, `CODE_OF_CONDUCT.md`, `CONTRIBUTING.md`, `SECURITY.md`, `env.example`, `docs/*`
- 추가로 **설정/리팩토링 변경이 많이 섞여 있음**(config, cache, notion retry, blog config, lockfiles 등)

---

### 2) 머지 리스크 평가 (중요도 순)

#### A. High: 락파일/패키지 매니저 정책 혼재

- `pnpm-lock.yaml` 변경은 정상적인 흐름인데, **`package-lock.json`도 대규모 변경**이 포함됨.
- 팀/CI에서 pnpm만 쓸 거면 `package-lock.json`은:
  - **(권장)** 앞으로 커밋에서 제외/삭제하고 npm 사용을 금지하거나,
  - 또는 npm도 “공식 지원”으로 인정하고 lockfile 2개를 관리해야 함(운영 난이도 상승).

판단: **이 PR을 머지하기 전에 “pnpm 단일 정책”인지 결정하는 게 가장 중요**.

#### B. Medium: CI/배포/환경변수의 실제 요구사항

- `.github/workflows/ci.yml`, `env.example`가 추가되면서 “재현성/표준화”는 좋아짐.
- 다만 **빌드 단계에서 어떤 env가 필수인지**에 따라 CI가 실패하거나, 반대로 CI가 너무 느슨할 수 있음.

판단: CI가 green이어도, **배포 환경(Vercel/standalone)에서 필요한 env가 실제로 충족되는지** 확인이 필요.

#### C. Low~Medium: ESLint 룰 완화

- `.eslintrc.js`에서 레거시/혼합 코드 때문에 룰을 완화한 변화가 포함됨.
- 장점: “지금 당장 린트 때문에 막히는 일”을 줄임.
- 단점: 코드 품질 게이트가 느슨해짐.

판단: OSS/운영 관점에서는 현실적인 선택. 단, 추후 “강화 로드맵”이 있으면 더 좋음.

---

### 3) 리뷰 포인트(파일별 체크리스트)

- **`.npmrc`**
  - `store-dir=.pnpm-store/v10`가 팀/CI 환경에서도 의도대로 동작하는지
  - `.pnpm-store`는 `.gitignore`로 무시되는지 ✅
- **`.github/workflows/ci.yml`**
  - pnpm 기준으로 install/build/tsc/lint가 수행되는지
  - env가 없어도 동작해야 하는 단계가 실패하지 않는지(빌드 시 env 필수면 secrets 필요)
- **`next.config.ts`**
  - `outputFileTracingRoot` 추가가 배포/standalone tracing 안정화에 도움 되는지(부작용 없는지)
- **`env.example`**
  - 실제 필요한 env(특히 Notion/Redis/Vercel 관련)가 충분히 문서화됐는지
- **lockfiles**
  - `package-lock.json`을 계속 유지할지(정책 결정 필요)

---

### 4) 머지 결론(판단)

**조건부 머지 OK.**

다음 조건이 만족되면 머지해도 안전하다고 판단:
- PR의 **CI 체크가 전부 Green**
- 로컬/프리뷰에서 최소 스모크 테스트 통과:
  - `pnpm install`
  - `pnpm dev`로 홈 로딩
  - 검색(Fuse), Notion 렌더, KaTeX/Prism, Tweet embed 화면 확인
- 그리고 가장 중요하게:
  - **패키지 매니저 정책을 “pnpm 단일”로 갈지** 정하고,
  - pnpm 단일이면 `package-lock.json`은 PR 또는 후속 PR에서 정리(커밋 제외/삭제/정책화)하는 방향 권장

---

### 5) 추천 머지 방식

- 커밋과 변경 성격이 다양하게 섞여 있으므로 **Squash merge 권장**
  - 히스토리 깔끔
  - revert 필요 시 영향 범위 파악이 쉬움
